---
title: Руководство по API
sidebar_position: 2
toc_min_heading_level: 3
toc_max_heading_level: 4
---

<!--
    The content below is simply an automatic conversion from the OpenAPI spec
    https://api.adguard-dns.io/static/swagger/openapi.json to markdown using
    https://swagger-markdown-ui.netlify.app/.

    Changelog is from here:
    https://api.adguard-dns.io/static/api/CHANGELOG.md

    If you want to change it, ask the developers to change the OpenAPI spec.
-->

## AdGuard DNS API

Документация по DNS API

## AdGuard DNS API Change Log

### v1.0

- Added authentication.
- CRUD operations with devices and DNS servers.
- Query log.
- Downloading DOT and DOT .mobileconfig.
- Filter Lists and Web-Services.

### v1.1

- Added methods to retrieve statistics by time, domains, companies and devices.

- Added method for updating device settings.
- Fixed required fields definition.

### v1.2

- Added new protocol types DNS and DNSCRYPT. Deprecating the PLAIN_TCP, PLAIN_UDP, DNSCRYPT_TCP and DNSCRYPT_UDP that will be removed later.

### v1.3

- Added method to get account limits.

### v1.4

- Added configurable option for blocking response: default (0.0.0.0), REFUSED, NXDOMAIN or custom IP-address.

### v1.5

- Added new setting `block_nrd` and group all security-related settings to one place.

#### Model for safebrowsing settings changed from

``` json
{
   "enabled": true
}
```

to:

``` json
{
   "enabled": true,
   "block_dangerous_domains": true,
   "block_nrd": false
}
```

where `enabled` is now control all settings in group, `block_dangerous_domains` is previous model field "enabled" and `block_nrd` is settings for filtering newly registered domains.

#### Model for saving server settings changed from

```json
{
  "protection_enabled" : true,
  "safebrowsing_enabled" : true,
  ...
}
```

to:

```json
{
  "protection_enabled" : true,
  "safebrowsing_settings" : {
     "enabled": true,
     "block_dangerous_domains": true,
     "block_nrd": false
  }
  ...
}
```

here new field `safebrowsing_settings` is used instead of deprecated `safebrowsing_enabled`, whose value stored in `block_dangerous_domains`.

## Version: 1.5

### /oapi/v1/account/limits

#### GET

##### Summary

Получает лимиты аккаунта

##### Ответы

| Код | Описание                      |
| --- | ----------------------------- |
| 200 | Информация о лимитах аккаунта |

### /oapi/v1/devices

#### GET

##### Summary

Перечисляет устройства

##### Ответы

| Код | Описание         |
| --- | ---------------- |
| 200 | Список устройств |

#### POST

##### Summary

Создаёт новое устройство

##### Ответы

| Код | Описание                              |
| --- | ------------------------------------- |
| 200 | Устройство создано                    |
| 400 | Ошибка проверки                       |
| 429 | Количество устройств достигло предела |

### /oapi/v1/devices/{device_id}

#### DELETE

##### Summary

Удаляет устройство

##### Параметры

| Имя       | Расположен в | Описание | Обязательно | Схема  |
| --------- | ------------ | -------- | ----------- | ------ |
| device_id | path         |          | Да          | string |

##### Ответы

| Код | Описание              |
| --- | --------------------- |
| 200 | Устройство удалено    |
| 404 | Устройство не найдено |

#### GET

##### Summary

Получает существующее устройство по ID

##### Параметры

| Имя       | Расположен в | Описание | Обязательно | Схема  |
| --------- | ------------ | -------- | ----------- | ------ |
| device_id | path         |          | Да          | string |

##### Ответы

| Код | Описание                 |
| --- | ------------------------ |
| 200 | Информация об устройстве |
| 404 | Устройство не найдено    |

#### PUT

##### Summary

Обновляет существующее устройство

##### Параметры

| Имя       | Расположен в | Описание | Обязательно | Схема  |
| --------- | ------------ | -------- | ----------- | ------ |
| device_id | path         |          | Да          | string |

##### Ответы

| Код | Описание              |
| --- | --------------------- |
| 200 | Устройство обновлено  |
| 400 | Ошибка проверки       |
| 404 | Устройство не найдено |

### /oapi/v1/devices/{device_id}/doh.mobileconfig

#### GET

##### Summary

Получает файл DNS-over-HTTPS .mobileconfig.

##### Параметры

| Имя                     | Расположен в | Описание                                                                                   | Обязательно | Схема      |
| ----------------------- | ------------ | ------------------------------------------------------------------------------------------ | ----------- | ---------- |
| device_id               | path         |                                                                                            | Да          | string     |
| exclude_wifi_networks | query        | Перечислите сети Wi-Fi по их SSID, для которых вы хотите отключить AdGuard DNS             | Нет         | [ string ] |
| exclude_domain          | query        | Перечислите домены, которые будут использовать DNS-серверы по умолчанию вместо AdGuard DNS | Нет         | [ string ] |

##### Ответы

| Код | Описание                   |
| --- | -------------------------- |
| 200 | Файл DNS-over-HTTPS .plist |
| 404 | Устройство не найдено      |

### /oapi/v1/devices/{device_id}/dot.mobileconfig

#### GET

##### Summary

Получает файл DNS-over-TLS .mobileconfig.

##### Параметры

| Имя                     | Расположен в | Описание                                                                                   | Обязательно | Схема      |
| ----------------------- | ------------ | ------------------------------------------------------------------------------------------ | ----------- | ---------- |
| device_id               | path         |                                                                                            | Да          | string     |
| exclude_wifi_networks | query        | Перечислите сети Wi-Fi по их SSID, для которых вы хотите отключить AdGuard DNS             | Нет         | [ string ] |
| exclude_domain          | query        | Перечислите домены, которые будут использовать DNS-серверы по умолчанию вместо AdGuard DNS | Нет         | [ string ] |

##### Ответы

| Код | Описание                   |
| --- | -------------------------- |
| 200 | Файл DNS-over-HTTPS .plist |
| 404 | Устройство не найдено      |

### /oapi/v1/devices/{device_id}/settings

#### PUT

##### Summary

Обновляет настройки устройства

##### Параметры

| Имя       | Расположен в | Описание | Обязательно | Схема  |
| --------- | ------------ | -------- | ----------- | ------ |
| device_id | path         |          | Да          | string |

##### Ответы

| Код | Описание                       |
| --- | ------------------------------ |
| 200 | Настройки устройства обновлены |
| 400 | Ошибка проверки                |
| 404 | Устройство не найдено          |

### /oapi/v1/dns_servers

#### GET

##### Summary

Перечисляет DNS-серверы, принадлежащие пользователю.

##### Описание

Перечисляет DNS-серверы, принадлежащие пользователю. By default there is at least one default server.

##### Ответы

| Код | Описание            |
| --- | ------------------- |
| 200 | Список DNS-серверов |

#### POST

##### Summary

Создаёт новый DNS-сервер

##### Описание

Создаёт новый DNS-сервер. Вы можете установить собственные настройки, в противном случае DNS-сервер будет создан с настройками по умолчанию.

##### Ответы

| Код | Описание                                 |
| --- | ---------------------------------------- |
| 200 | DNS-сервер создан                        |
| 400 | Ошибка проверки                          |
| 429 | Количество DNS-серверов достигло предела |

### /oapi/v1/dns_servers/{dns_server_id}

#### DELETE

##### Summary

Удаляет DNS-сервер

##### Описание

Удаляет DNS-сервер. Все устройства, подключённые к этому DNS-серверу, будут перемещены на DNS-сервер по умолчанию. Deleting the default DNS server is forbidden.

##### Параметры

| Имя             | Расположен в | Описание | Обязательно | Схема  |
| --------------- | ------------ | -------- | ----------- | ------ |
| dns_server_id | path         |          | Да          | string |

##### Ответы

| Код | Описание             |
| --- | -------------------- |
| 200 | DNS-сервер удалён    |
| 404 | DNS-сервер не найден |

#### GET

##### Summary

Получает существующий DNS-сервер по ID

##### Параметры

| Имя             | Расположен в | Описание | Обязательно | Схема  |
| --------------- | ------------ | -------- | ----------- | ------ |
| dns_server_id | path         |          | Да          | string |

##### Ответы

| Код | Описание                 |
| --- | ------------------------ |
| 200 | Информация о DNS-сервере |
| 404 | DNS-сервер не найден     |

#### PUT

##### Summary

Обновляет существующий DNS-сервер

##### Параметры

| Имя             | Расположен в | Описание | Обязательно | Схема  |
| --------------- | ------------ | -------- | ----------- | ------ |
| dns_server_id | path         |          | Да          | string |

##### Ответы

| Код | Описание             |
| --- | -------------------- |
| 200 | DNS-сервер обновлён  |
| 400 | Ошибка проверки      |
| 404 | DNS-сервер не найден |

### /oapi/v1/dns_servers/{dns_server_id}/settings

#### PUT

##### Summary

Обновляет настройки DNS-сервера

##### Параметры

| Имя             | Расположен в | Описание | Обязательно | Схема  |
| --------------- | ------------ | -------- | ----------- | ------ |
| dns_server_id | path         |          | Да          | string |

##### Ответы

| Код | Описание                        |
| --- | ------------------------------- |
| 200 | Настройки DNS-сервера обновлены |
| 400 | Ошибка проверки                 |
| 404 | DNS-сервер не найден            |

### /oapi/v1/filter_lists

#### GET

##### Summary

Получает списки фильтров

##### Ответы

| Код | Описание        |
| --- | --------------- |
| 200 | Список фильтров |

### /oapi/v1/oauth_token

#### POST

##### Summary

Генерирует токен доступа и продлеваемый токен

##### Ответы

| Код | Описание                                                                        |
| --- | ------------------------------------------------------------------------------- |
| 200 | Выдан токен доступа                                                             |
| 400 | Отсутствуют обязательные параметры                                              |
| 401 | Предоставлены недействительные учётные данные, токен MFA или продлеваемый токен |

null

### /oapi/v1/query_log

#### DELETE

##### Summary

Очищает журнал запросов

##### Ответы

| Код | Описание                   |
| --- | -------------------------- |
| 202 | Журнал запросов был очищен |

#### GET

##### Summary

Получает журнал запросов

##### Параметры

| Имя                | Расположен в | Описание                                                                     | Обязательно | Схема                                               |
| ------------------ | ------------ | ---------------------------------------------------------------------------- | ----------- | --------------------------------------------------- |
| time_from_millis | query        | Время от в миллисекундах (включительно)                                      | Да          | long                                                |
| time_to_millis   | query        | Время до в миллисекундах (включительно)                                      | Да          | long                                                |
| devices            | query        | Фильтровать по устройствам                                                   | Нет         | [ string ]                                          |
| countries          | query        | Фильтровать по странам                                                       | Нет         | [ string ]                                          |
| companies          | query        | Фильтровать по компаниям                                                     | Нет         | [ string ]                                          |
| statuses           | query        | Фильтровать по статусам                                                      | Нет         | [ [FilteringActionStatus](#FilteringActionStatus) ] |
| categories         | query        | Фильтровать по категориям                                                    | Нет         | [ [CategoryType](#CategoryType) ]                   |
| search             | query        | Фильтровать по доменному имени                                               | Нет         | string                                              |
| limit              | query        | Ограничить количество возвращаемых записей                                   | Нет         | integer                                             |
| cursor             | query        | Курсорная пагинация. Используйте курсор из ответа для разбивки по страницам. | Нет         | string                                              |

##### Ответы

| Код | Описание  |
| --- | --------- |
| 200 | Query log |

### /oapi/v1/revoke_token

#### POST

##### Summary

Отзывает продлеваемый токен

##### Параметры

| Имя           | Расположен в | Описание           | Обязательно | Схема  |
| ------------- | ------------ | ------------------ | ----------- | ------ |
| refresh_token | query        | Продлеваемый токен | Да          | string |

##### Ответы

| Код | Описание                   |
| --- | -------------------------- |
| 200 | Продлеваемый токен отозван |

null

### /oapi/v1/stats/categories

#### GET

##### Summary

Получает статистику категорий

##### Параметры

| Имя                | Расположен в | Описание                                | Обязательно | Схема      |
| ------------------ | ------------ | --------------------------------------- | ----------- | ---------- |
| time_from_millis | query        | Время от в миллисекундах (включительно) | Да          | long       |
| time_to_millis   | query        | Время до в миллисекундах (включительно) | Да          | long       |
| devices            | query        | Фильтровать по устройствам              | Нет         | [ string ] |
| countries          | query        | Фильтровать по странам                  | Нет         | [ string ] |

##### Ответы

| Код | Описание                          |
| --- | --------------------------------- |
| 200 | Получена статистика по категориям |
| 400 | Ошибка проверки                   |

### /oapi/v1/stats/companies

#### GET

##### Summary

Получает статистику компаний

##### Параметры

| Имя                | Расположен в | Описание                                | Обязательно | Схема      |
| ------------------ | ------------ | --------------------------------------- | ----------- | ---------- |
| time_from_millis | query        | Время от в миллисекундах (включительно) | Да          | long       |
| time_to_millis   | query        | Время до в миллисекундах (включительно) | Да          | long       |
| devices            | query        | Фильтровать по устройствам              | Нет         | [ string ] |
| countries          | query        | Фильтровать по странам                  | Нет         | [ string ] |

##### Ответы

| Код | Описание                         |
| --- | -------------------------------- |
| 200 | Получена статистика по компаниям |
| 400 | Ошибка проверки                  |

### /oapi/v1/stats/companies/detailed

#### GET

##### Summary

Получает подробную статистику компаний

##### Параметры

| Имя                | Расположен в | Описание                                | Обязательно | Схема      |
| ------------------ | ------------ | --------------------------------------- | ----------- | ---------- |
| time_from_millis | query        | Время от в миллисекундах (включительно) | Да          | long       |
| time_to_millis   | query        | Время до в миллисекундах (включительно) | Да          | long       |
| devices            | query        | Фильтровать по устройствам              | Нет         | [ string ] |
| countries          | query        | Фильтровать по странам                  | Нет         | [ string ] |
| cursor             | query        | Курсорная пагинация                     | Нет         | string     |

##### Ответы

| Код | Описание                                   |
| --- | ------------------------------------------ |
| 200 | Получена подробная статистика по компаниям |
| 400 | Ошибка проверки                            |

### /oapi/v1/stats/countries

#### GET

##### Summary

Получает статистику по странам

##### Параметры

| Имя                | Расположен в | Описание                                | Обязательно | Схема      |
| ------------------ | ------------ | --------------------------------------- | ----------- | ---------- |
| time_from_millis | query        | Время от в миллисекундах (включительно) | Да          | long       |
| time_to_millis   | query        | Время до в миллисекундах (включительно) | Да          | long       |
| devices            | query        | Фильтровать по устройствам              | Нет         | [ string ] |
| countries          | query        | Фильтровать по странам                  | Нет         | [ string ] |

##### Ответы

| Код | Описание                       |
| --- | ------------------------------ |
| 200 | Получена статистика по странам |
| 400 | Ошибка проверки                |

### /oapi/v1/stats/devices

#### GET

##### Summary

Получает статистику по устройствам

##### Параметры

| Имя                | Расположен в | Описание                                | Обязательно | Схема      |
| ------------------ | ------------ | --------------------------------------- | ----------- | ---------- |
| time_from_millis | query        | Время от в миллисекундах (включительно) | Да          | long       |
| time_to_millis   | query        | Время до в миллисекундах (включительно) | Да          | long       |
| devices            | query        | Фильтровать по устройствам              | Нет         | [ string ] |
| countries          | query        | Фильтровать по странам                  | Нет         | [ string ] |

##### Ответы

| Код | Описание                           |
| --- | ---------------------------------- |
| 200 | Получена статистика по устройствам |
| 400 | Ошибка проверки                    |

### /oapi/v1/stats/domains

#### GET

##### Summary

Получает статистику по доменам

##### Параметры

| Имя                | Расположен в | Описание                                | Обязательно | Схема      |
| ------------------ | ------------ | --------------------------------------- | ----------- | ---------- |
| time_from_millis | query        | Время от в миллисекундах (включительно) | Да          | long       |
| time_to_millis   | query        | Время до в миллисекундах (включительно) | Да          | long       |
| devices            | query        | Фильтровать по устройствам              | Нет         | [ string ] |
| countries          | query        | Фильтровать по странам                  | Нет         | [ string ] |

##### Ответы

| Код | Описание                       |
| --- | ------------------------------ |
| 200 | Получена статистика по доменам |
| 400 | Ошибка проверки                |

### /oapi/v1/stats/time

#### GET

##### Summary

Получает статистику по времени

##### Параметры

| Имя                | Расположен в | Описание                                | Обязательно | Схема      |
| ------------------ | ------------ | --------------------------------------- | ----------- | ---------- |
| time_from_millis | query        | Время от в миллисекундах (включительно) | Да          | long       |
| time_to_millis   | query        | Время до в миллисекундах (включительно) | Да          | long       |
| devices            | query        | Фильтровать по устройствам              | Нет         | [ string ] |
| countries          | query        | Фильтровать по странам                  | Нет         | [ string ] |

##### Ответы

| Код | Описание                       |
| --- | ------------------------------ |
| 200 | Получена статистика по времени |
| 400 | Ошибка проверки                |

### /oapi/v1/web_services

#### GET

##### Summary

Перечисляет веб-службы

##### Ответы

| Код | Описание         |
| --- | ---------------- |
| 200 | Список веб-служб |
